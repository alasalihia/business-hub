<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة الإدارة المتكاملة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; }
        .screen { display: none; }
        .screen.active { display: block; }
        #login-screen.active { display: flex; }
        .module-card { transition: transform 0.2s, box-shadow 0.2s; }
        .module-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .module-card.disabled { cursor: not-allowed; opacity: 0.6; }
        .module-card.disabled:hover { transform: none; box-shadow: none; }
        #main-app-container { display: none; }
        #main-app-container.active { display: block; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- SCREEN: Login -->
    <div id="login-screen" class="screen flex-col items-center justify-center p-8 min-h-screen">
        <div class="text-center bg-white p-12 rounded-2xl shadow-xl max-w-lg w-full mx-auto">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">منصة الإدارة المتكاملة</h1>
            <p class="text-slate-600 mb-8">يرجى تسجيل الدخول للوصول إلى أنظمة العمل.</p>
            <button id="login-button" class="flex items-center justify-center w-full bg-white border border-slate-300 hover:bg-slate-100 text-slate-700 font-semibold py-3 px-6 rounded-lg transition-colors shadow-sm">
                <svg class="w-6 h-6 ml-3" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                تسجيل الدخول باستخدام جوجل
            </button>
        </div>
    </div>

    <!-- SCREEN: Main Menu -->
    <div id="main-menu-screen" class="screen min-h-screen p-8">
        <header class="flex justify-between items-center mb-12">
            <h1 class="text-3xl font-bold text-slate-800">القائمة الرئيسية</h1>
            <div class="flex items-center">
                <span id="main-menu-user-display-name" class="font-semibold ml-4 text-slate-600"></span>
                <button id="logout-button" class="text-sm text-red-600 hover:underline mr-2">تسجيل الخروج</button>
            </div>
        </header>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            <!-- HR Module Card -->
            <div onclick="loadModule('hr.html')" class="module-card bg-white p-8 rounded-2xl shadow-lg text-center cursor-pointer">
                <div class="bg-violet-100 text-violet-600 rounded-full h-20 w-20 flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                </div>
                <h3 class="text-2xl font-bold text-slate-800">نظام شؤون الموظفين</h3>
                <p class="text-slate-500 mt-2">الرواتب، الإجازات، والتقارير.</p>
            </div>
             <!-- Logistics Module Card (Disabled) -->
            <div class="module-card bg-white p-8 rounded-2xl shadow-lg text-center disabled">
                <div class="bg-teal-100 text-teal-600 rounded-full h-20 w-20 flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>
                </div>
                <h3 class="text-2xl font-bold text-slate-800">نظام إدارة التخزين</h3>
                <p class="text-slate-500 mt-2">قريباً...</p>
            </div>
        </div>
    </div>

    <!-- CONTAINER for loaded modules -->
    <div id="main-app-container">
        <!-- Module content will be loaded here -->
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDSlxf95W00Ow6LZba8waAKJINptIRPkU8",
            authDomain: "sample-firebase-ai-app-960f4.firebaseapp.com",
            projectId: "sample-firebase-ai-app-960f4",
            storageBucket: "sample-firebase-ai-app-960f4.appspot.com",
            messagingSenderId: "741880884079",
            appId: "1:741880884079:web:8d62f6e233fb65e65e969a"
        };

        // Initialize Firebase and make services globally available for modules
        window.app = initializeApp(firebaseConfig);
        window.auth = getAuth(window.app);
        window.db = getFirestore(window.app);

        const loginScreen = document.getElementById('login-screen');
        const mainMenuScreen = document.getElementById('main-menu-screen');
        const mainAppContainer = document.getElementById('main-app-container');
        const userDisplayName = document.getElementById('main-menu-user-display-name');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');

        // Central navigation function
        window.showScreen = (screenId) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            mainAppContainer.classList.remove('active');
            mainAppContainer.innerHTML = ''; // Clear container when showing a main screen
            document.getElementById(screenId).classList.add('active');
        };

        // Authentication state listener
        onAuthStateChanged(window.auth, user => {
            if (user) {
                userDisplayName.textContent = user.displayName || user.email;
                showScreen('main-menu-screen');
            } else {
                showScreen('login-screen');
            }
        });

        // Event Listeners
        loginButton.addEventListener('click', () => {
            const provider = new GoogleAuthProvider();
            signInWithPopup(window.auth, provider).catch(error => console.error("Auth Error", error));
        });

        logoutButton.addEventListener('click', () => {
            signOut(window.auth).catch(error => console.error("Sign Out Error", error));
        });

        // Robust module loader
        window.loadModule = async (moduleUrl) => {
            try {
                const response = await fetch(moduleUrl);
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.status}`);
                }
                const htmlText = await response.text();
                
                // Hide main screens and show the app container
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                mainAppContainer.innerHTML = htmlText;
                mainAppContainer.classList.add('active');

                // Find the main module script and re-create it to force execution
                const moduleScript = mainAppContainer.querySelector('script[type="module"]');
                if (moduleScript) {
                    const script = document.createElement('script');
                    script.type = 'module';
                    script.textContent = moduleScript.textContent;
                    // Remove the old, non-executed script from the DOM
                    moduleScript.remove();
                    // Append the new, executable script
                    document.body.appendChild(script);
                }
            } catch (error) {
                console.error("Error loading module:", error);
                alert("حدث خطأ أثناء تحميل النظام. يرجى التأكد من أن الملف موجود والمحاولة مرة أخرى.");
                showScreen('main-menu-screen'); // Go back to menu on error
            }
        };

    </script>
</body>
</html>
